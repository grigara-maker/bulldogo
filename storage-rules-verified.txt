// Firebase Storage pravidla - VERIFIKOVAN√Å VERZE
// Tyto pravidla jsou kompatibiln√≠ s k√≥dem v aplikaci
// 
// D≈ÆLE≈ΩIT√â: Zkop√≠rujte tento obsah do Firebase Console ‚Üí Storage ‚Üí Rules ‚Üí Edit
// POZN√ÅMKA: P≈ôi testov√°n√≠ v Rules simul√°toru zvolte "Write" jako Simulation type

rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // ===== OBR√ÅZKY SLU≈ΩEB/INZER√ÅT≈Æ =====
    // Povolit p≈ôihl√°≈°en√Ωm u≈æivatel≈Øm nahr√°vat obr√°zky slu≈æeb do jejich slo≈æek
    // Cesty v k√≥du: services/{userId}/{timestamp}_preview.jpg, services/{userId}/{timestamp}_{i}.jpg
    match /services/{userId}/{allPaths=**} {
      // Ka≈æd√Ω m≈Ø≈æe ƒç√≠st obr√°zky slu≈æeb
      allow read: if true;
      
      // Pouze vlastn√≠k (userId odpov√≠d√° UID) m≈Ø≈æe nahr√°vat a upravovat
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ===== PROFILOV√â OBR√ÅZKY =====
    // Povolit p≈ôihl√°≈°en√Ωm u≈æivatel≈Øm nahr√°vat profilov√© obr√°zky
    // POZN√ÅMKA: V k√≥du se pou≈æ√≠vaj√≠ cesty typu: services/{userId}/profile/avatar_{timestamp}.{ext}
    // Tak≈æe tyto obr√°zky jsou pokryty pravidlem v√Ω≈°e pro /services/{userId}/{allPaths=**}
    // Toto pravidlo je pro p≈ô√≠pad, ≈æe byste chtƒõli pou≈æ√≠t samostatnou slo≈æku /profile-pictures/
    match /profile-pictures/{userId}/{allPaths=**} {
      // Ka≈æd√Ω m≈Ø≈æe ƒç√≠st profilov√© obr√°zky
      allow read: if true;
      
      // Pouze vlastn√≠k (userId odpov√≠d√° UID) m≈Ø≈æe nahr√°vat, upravovat a mazat
      allow write: if request.auth != null && request.auth.uid == userId;
      allow delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // ===== OBR√ÅZKY V CHATU =====
    // Povolit p≈ôihl√°≈°en√Ωm u≈æivatel≈Øm nahr√°vat obr√°zky do chatu
    // Cesta v k√≥du: chat/{conversationId}/{timestamp}_{filename}
    match /chat/{conversationId}/{allPaths=**} {
      // Ka≈æd√Ω p≈ôihl√°≈°en√Ω u≈æivatel m≈Ø≈æe ƒç√≠st obr√°zky z konverzac√≠
      allow read: if request.auth != null;
      
      // Ka≈æd√Ω p≈ôihl√°≈°en√Ω u≈æivatel m≈Ø≈æe nahr√°vat obr√°zky do konverzac√≠
      allow write: if request.auth != null;
    }
    
    // ===== V√ùCHOZ√ç: ZAK√ÅZAT P≈ò√çSTUP =====
    // V≈°echno ostatn√≠ je zak√°zan√©
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

// D≈ÆLE≈ΩIT√â POZN√ÅMKY:
// 1. Pravidla jsou kompatibiln√≠ s k√≥dem v aplikaci
// 2. Pokud se st√°le objevuj√≠ chyby 404, probl√©m je pravdƒõpodobnƒõ v k√≥du, ne v pravidlech
// 3. Chyby 404 znamenaj√≠, ≈æe soubory neexistuj√≠ - buƒè se nenahr√°vaj√≠, nebo se ma≈æou
// 4. Chyby 403 znamenaj√≠, ≈æe pravidla blokuj√≠ p≈ô√≠stup - to by se mƒõlo opravit tƒõmito pravidly
// 5. Zkontrolujte konzoli prohl√≠≈æeƒçe pro logy z uploadu (üì∏ Nahr√°v√°m n√°hledov√Ω obr√°zek...)

