<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hodnocen√≠ - BULLDOGO</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"></noscript>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';

        // Firebase konfigurace
        const firebaseConfig = {
            apiKey: "AIzaSyA1FEmsY458LLKQLGcUaOVXsYr3Ii55QeQ",
            authDomain: "inzerio-inzerce.firebaseapp.com",
            projectId: "inzerio-inzerce",
            storageBucket: "inzerio-inzerce.firebasestorage.app",
            messagingSenderId: "262039290071",
            appId: "1:262039290071:web:30af0eb1c65cd75e307092",
            measurementId: "G-7VD0ZE08M3"
        };
        
        // Inicializace Firebase
        const app = initializeApp(firebaseConfig);
        const firebaseAuth = getAuth(app);
        const firebaseDb = getFirestore(app);
        const analytics = getAnalytics(app);
        
        // Export pro glob√°ln√≠ pou≈æit√≠
        window.firebaseApp = app;
        window.firebaseAuth = firebaseAuth;
        window.firebaseDb = firebaseDb;
    </script>
</head>
<body>
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <!-- Logo Section -->
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">B</div>
                <span class="logo-text">
                    <span class="logo-bull">ULL</span>
                    <span class="logo-dogo">DOGO</span>
                </span>
            </div>
            <div class="header-buttons">
            </div>
        </div>

        <!-- Navigation Section -->
        <div class="navigation-section">
            <h3 class="nav-section-title">NAVIGACE</h3>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home nav-icon"></i>
                        <span class="nav-text">Dom≈Ø</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="services.html" class="nav-link">
                        <i class="fas fa-list-alt nav-icon"></i>
                        <span class="nav-text">Slu≈æby</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="my-ads.html" class="nav-link">
                        <i class="fas fa-user nav-icon"></i>
                        <span class="nav-text">M√© inzer√°ty</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="index.html#features" class="nav-link">
                        <i class="fas fa-info-circle nav-icon"></i>
                        <span class="nav-text">O n√°s</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="index.html#contact" class="nav-link">
                        <i class="fas fa-envelope nav-icon"></i>
                        <span class="nav-text">Kontakt</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="chat.html" class="nav-link">
                        <i class="fas fa-comment-alt nav-icon"></i>
                        <span class="nav-text">Chat</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="top-ads.html" class="nav-link">
                        <i class="fas fa-fire nav-icon"></i>
                        <span class="nav-text">Topov√°n√≠</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="packages.html" class="nav-link">
                        <i class="fas fa-box nav-icon"></i>
                        <span class="nav-text">Bal√≠ƒçky</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Auth Buttons Section (shown when not logged in) -->
        <div class="auth-section" id="authSection">
            <button class="btn-login" onclick="showAuthModal('login')">
                <i class="fas fa-sign-in-alt"></i>
                <span>P≈ôihl√°≈°en√≠</span>
            </button>
            <button class="btn-register" onclick="showAuthModal('register')">
                <i class="fas fa-user-plus"></i>
                <span>Registrace</span>
            </button>
        </div>

        <!-- User Profile Section (shown when logged in) -->
        <div class="user-profile-section" id="userProfileSection" style="display: none;">
            <button class="btn-profile" onclick="window.location.href='profile.html'">
                <i class="fas fa-user-circle"></i>
                <span>Profil</span>
            </button>
            <button class="btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Odhl√°sit se</span>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Toggle Button (when collapsed) -->
    <button class="sidebar-toggle-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Main Content Wrapper -->
    <div class="main-content">
        <!-- Profile Hero Section -->
        <section class="page-hero">
            <div class="container">
                <div class="page-hero-card">
                    <div class="page-hero-inner">
                        <h2 class="services-title"><span class="title-text">Hodnocen√≠</span><span class="title-accent"></span></h2>
                        <p class="page-hero-subtitle">P≈ôehled va≈°ich hodnocen√≠ a recenz√≠</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn" onclick="window.location.href='profile.html'">P≈ôehled</button>
            <button class="tab-btn active">Hodnocen√≠</button>
            <button class="tab-btn" onclick="window.location.href='profile-settings.html'">Nastaven√≠</button>
            <button class="tab-btn" onclick="window.location.href='profile-plan.html'">Spravovat bal√≠ƒçek</button>
            <button class="tab-btn" onclick="window.location.href='top-ads.html'">Topov√°n√≠</button>
        </div>

        <!-- Ratings Content -->
        <div class="ratings-content">
            <div class="ratings-summary">
                <div class="overall-rating">
                    <div class="rating-number">-</div>
                    <div class="rating-stars">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="rating-count">Naƒç√≠t√°n√≠ hodnocen√≠...</div>
                </div>
                <div class="rating-breakdown">
                    <div class="rating-bar rating-bar-5">
                        <span>5 hvƒõzd</span>
                        <div class="bar">
                            <div class="fill" style="width: 0%"></div>
                        </div>
                        <span class="rating-count">0</span>
                    </div>
                    <div class="rating-bar rating-bar-4">
                        <span>4 hvƒõzdy</span>
                        <div class="bar">
                            <div class="fill" style="width: 0%"></div>
                        </div>
                        <span class="rating-count">0</span>
                    </div>
                    <div class="rating-bar rating-bar-3">
                        <span>3 hvƒõzdy</span>
                        <div class="bar">
                            <div class="fill" style="width: 0%"></div>
                        </div>
                        <span class="rating-count">0</span>
                    </div>
                    <div class="rating-bar rating-bar-2">
                        <span>2 hvƒõzdy</span>
                        <div class="bar">
                            <div class="fill" style="width: 0%"></div>
                        </div>
                        <span class="rating-count">0</span>
                    </div>
                    <div class="rating-bar rating-bar-1">
                        <span>1 hvƒõzda</span>
                        <div class="bar">
                            <div class="fill" style="width: 0%"></div>
                        </div>
                        <span class="rating-count">0</span>
                    </div>
                </div>
            </div>

            <div class="reviews-section">
                <h3 class="section-title">Recenze</h3>
                <div class="reviews-list">
                    <!-- Hodnocen√≠ se naƒçtou dynamicky z Firebase -->
                            </div>
                        </div>
                        </div>
                    </div>

    <script src="script.js" defer></script>
    <script src="auth.js" defer></script>
    <script src="cities.js" defer></script>
    <script src="click-spark.js" defer></script>
    <script>
        // Load user ratings from Firebase + refresh p≈ôi n√°vratu
        document.addEventListener('DOMContentLoaded', () => {
            // Nevolat loadRatingsData hned - poƒçkat na auth state
            loadUserProfile();
        });
        window.addEventListener('pageshow', () => {
            // Poƒçkat na auth state p≈ôed naƒçten√≠m dat
            if (window.firebaseAuth?.currentUser) {
                loadRatingsData();
                loadUserData?.();
            }
        });
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && window.firebaseAuth?.currentUser) {
                loadRatingsData();
            }
        });

        // Load user profile data
        async function loadUserProfile() {
            console.log('üîß Loading user profile...');
            try {
                // Wait for Firebase to be available
                const checkFirebase = setInterval(() => {
                    console.log('üîç Checking Firebase:', {
                        firebaseAuth: !!window.firebaseAuth,
                        firebaseDb: !!window.firebaseDb
                    });
                    if (window.firebaseAuth && window.firebaseDb) {
                        console.log('‚úÖ Firebase available, checking auth');
                        clearInterval(checkFirebase);
                        
                        // Check if user is logged in
                        const currentUser = window.firebaseAuth.currentUser;
                        if (!currentUser) {
                            // User is not logged in - redirect to login
                            console.log('‚ö†Ô∏è U≈æivatel nen√≠ p≈ôihl√°≈°en - p≈ôesmƒõrov√°n√≠ na p≈ôihl√°≈°en√≠');
                            if (typeof showAuthModal === 'function') {
                                showAuthModal('login');
                            } else {
                                window.location.href = 'index.html';
                            }
                            return;
                        }
                        
                        // Listen for auth state changes FIRST
                        window.firebaseAuth.onAuthStateChanged((user) => {
                            console.log('üë§ Auth state changed on profile-ratings page:', user ? user.email : 'Not logged in');
                            if (user) {
                                console.log('‚úÖ User logged in, loading data...');
                                loadUserData();
                                loadRatingsData();
                            } else {
                                // User logged out - redirect to login
                                console.log('‚ö†Ô∏è U≈æivatel se odhl√°sil - p≈ôesmƒõrov√°n√≠ na p≈ôihl√°≈°en√≠');
                                if (typeof showAuthModal === 'function') {
                                    showAuthModal('login');
                                } else {
                                    window.location.href = 'index.html';
                                }
                            }
                        });
                        
                        // Pokud je u≈æivatel u≈æ p≈ôihl√°≈°en, naƒç√≠st data
                        const currentUser = window.firebaseAuth.currentUser;
                        if (currentUser) {
                            console.log('‚úÖ User already logged in, loading data immediately');
                            loadUserData();
                            loadRatingsData();
                        }
                    }
                }, 100);
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ profilu:', error);
            }
        }

        async function loadUserRatings() {
            // Tato funkce je zastaral√° - pou≈æ√≠v√° se loadRatingsData() p≈ô√≠mo
            // Nech√°me ji pro kompatibilitu, ale nevol√°me ji
            console.log('‚ö†Ô∏è loadUserRatings() is deprecated, use loadRatingsData() instead');
        }

        // Global variable for reviews (stejnƒõ jako v profile-detail.js)
        let userReviews = [];

        async function loadRatingsData() {
            try {
                const currentUser = window.firebaseAuth.currentUser;
                if (!currentUser) {
                    console.log('U≈æivatel nen√≠ p≈ôihl√°≈°en');
                    return;
                }

                console.log('‚úÖ Naƒç√≠t√°m hodnocen√≠ pro u≈æivatele:', currentUser.uid);

                // Naƒç√≠st recenze PRVN√ç - p≈ôed aktualizac√≠ display
                await loadUserReviews(currentUser.uid);
                console.log('üìö Naƒçteno recenz√≠:', userReviews.length);
                console.log('üìö Recenze data:', userReviews);

                // Load user profile to get rating data
                const { getDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const profileRef = doc(window.firebaseDb, 'users', currentUser.uid, 'profile', 'profile');
                const profileSnap = await getDoc(profileRef);
                
                let userProfile = null;
                if (profileSnap.exists()) {
                    userProfile = profileSnap.data();
                }

                // Aktualizovat rating display z naƒçten√Ωch recenz√≠ (ne z profilu)
                if (userReviews.length > 0) {
                    console.log('üìä Aktualizuji rating z recenz√≠:', userReviews.length);
                    updateRatingFromReviews(userReviews);
                } else {
                    // Pokud nejsou recenze, pou≈æ√≠t data z profilu
                    console.log('üìä Pou≈æ√≠v√°m data z profilu (≈æ√°dn√© recenze)');
                    updateRatingsDisplay(userProfile);
                }
                
                // Zobrazit recenze - POƒåKAT a≈æ se rating aktualizuje
                console.log('üé® Zobrazuji recenze, userReviews.length:', userReviews.length);
                await displayUserReviews();
                console.log('‚úÖ Recenze zobrazeny');

            } catch (error) {
                console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ dat hodnocen√≠:', error);
                console.error('Error stack:', error.stack);
            }
        }

        // Jednoduch√° funkce pro naƒçten√≠ a zobrazen√≠ v≈°ech recenz√≠
        async function loadAndDisplayAllReviews(userId) {
            console.log('üìö ZAƒå√çN√ÅM NAƒå√çTAT RECENZE PRO U≈ΩIVATELE:', userId);
            
            try {
                const { getDocs, collection, collectionGroup } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const allReviews = [];
                
                // 1. Naƒç√≠st recenze na profilu
                try {
                    console.log('üìñ 1. Naƒç√≠t√°m recenze z profilu...');
                    const profileReviewsRef = collection(window.firebaseDb, 'users', userId, 'reviews');
                    const profileSnap = await getDocs(profileReviewsRef);
                    console.log('üìñ 1. Nalezeno recenz√≠ na profilu:', profileSnap.size);
                    
                    profileSnap.forEach(doc => {
                        const data = doc.data();
                        console.log('üìñ 1. Recenze z profilu:', doc.id, data);
                        allReviews.push({
                            id: doc.id,
                            ...data,
                            type: 'profile'
                        });
                    });
                } catch (error) {
                    console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ recenz√≠ z profilu:', error);
                }
                
                // 2. Naƒç√≠st recenze z inzer√°t≈Ø pomoc√≠ collectionGroup
                try {
                    console.log('üìñ 2. Naƒç√≠t√°m recenze z inzer√°t≈Ø...');
                    const adReviewsGroup = collectionGroup(window.firebaseDb, 'reviews');
                    const adReviewsSnap = await getDocs(adReviewsGroup);
                    console.log('üìñ 2. Nalezeno recenz√≠ celkem (collectionGroup):', adReviewsSnap.size);
                    
                    adReviewsSnap.forEach(docSnap => {
                        const reviewData = docSnap.data();
                        const parent = docSnap.ref.parent;
                        const adDoc = parent?.parent;
                        const inzeraty = adDoc?.parent;
                        const userDoc = inzeraty?.parent;
                        
                        if (userDoc && userDoc.id === userId && inzeraty.id === 'inzeraty') {
                            console.log('üìñ 2. Recenze z inzer√°tu:', docSnap.id, reviewData);
                            allReviews.push({
                                id: docSnap.id,
                                ...reviewData,
                                type: 'ad',
                                adId: adDoc.id
                            });
                        }
                    });
                    console.log('üìñ 2. Nalezeno recenz√≠ z inzer√°t≈Ø tohoto u≈æivatele:', allReviews.filter(r => r.type === 'ad').length);
                } catch (error) {
                    console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ recenz√≠ z inzer√°t≈Ø:', error);
                }
                
                console.log('‚úÖ CELKEM NAƒåTENO RECENZ√ç:', allReviews.length);
                console.log('üìä V≈†ECHNY RECENZE:', allReviews);
                
                // Zobrazit recenze
                console.log('üé® VOL√ÅM DISPLAYALLREVIEWS S', allReviews.length, 'RECENZEMI');
                displayAllReviews(allReviews);
                
                // Aktualizovat statistiky
                updateRatingFromReviews(allReviews);
                
            } catch (error) {
                console.error('‚ùå CHYBA P≈òI NAƒå√çT√ÅN√ç RECENZ√ç:', error);
                console.error('‚ùå Error details:', error);
            }
        }

        // Jednoduch√° funkce pro zobrazen√≠ v≈°ech recenz√≠
        function displayAllReviews(reviews) {
            console.log('üé® DISPLAYALLREVIEWS VOL√ÅNO S', reviews?.length || 0, 'RECENZEMI');
            console.log('üé® Reviews data:', reviews);
            
            const container = document.querySelector('.reviews-list');
            console.log('üé® Kontejner .reviews-list:', container);
            
            if (!container) {
                console.error('‚ùå‚ùå‚ùå KONTEJNER .reviews-list NENALEZEN!');
                // Zkusit naj√≠t jak√Ωkoli kontejner
                const allContainers = document.querySelectorAll('[class*="review"], [id*="review"]');
                console.log('üé® Nalezen√© kontejnery:', allContainers);
                return;
            }
            
            console.log('‚úÖ‚úÖ‚úÖ KONTEJNER NALEZEN, zobrazuji', reviews.length, 'recenz√≠');
            
            if (reviews.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 16px; border: 2px dashed #e5e7eb;">
                        <i class="fas fa-star" style="font-size: 48px; color: #d1d5db; margin-bottom: 16px;"></i>
                        <p style="font-size: 16px; color: #6b7280; margin: 0; font-weight: 500;">Zat√≠m nem√°te ≈æ√°dn√© recenze.</p>
                    </div>
                `;
                return;
            }
            
            // Se≈ôadit podle data (nejnovƒõj≈°√≠ prvn√≠)
            reviews.sort((a, b) => {
                const dateA = a.createdAt?.toDate ? a.createdAt.toDate() : (a.createdAt ? new Date(a.createdAt) : new Date(0));
                const dateB = b.createdAt?.toDate ? b.createdAt.toDate() : (b.createdAt ? new Date(b.createdAt) : new Date(0));
                return dateB - dateA;
            });
            
            // Zobrazit recenze
            container.innerHTML = reviews.map(review => {
                const rating = review.rating || 0;
                const filledStars = '‚òÖ'.repeat(rating);
                const emptyStars = '‚òÜ'.repeat(5 - rating);
                const text = review.text || review.comment || '≈Ω√°dn√Ω koment√°≈ô';
                const reviewerName = review.reviewerName || review.reviewerEmail?.split('@')[0] || 'Anonymn√≠';
                
                let dateStr = 'Nezn√°m√© datum';
                if (review.createdAt) {
                    if (review.createdAt.toDate) {
                        const date = review.createdAt.toDate();
                        const now = new Date();
                        const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
                        if (diffDays === 0) dateStr = 'Dnes';
                        else if (diffDays === 1) dateStr = 'Vƒçera';
                        else if (diffDays < 7) dateStr = `P≈ôed ${diffDays} dny`;
                        else if (diffDays < 30) dateStr = `P≈ôed ${Math.floor(diffDays / 7)} t√Ωdny`;
                        else if (diffDays < 365) dateStr = `P≈ôed ${Math.floor(diffDays / 30)} mƒõs√≠ci`;
                        else dateStr = `P≈ôed ${Math.floor(diffDays / 365)} lety`;
                    }
                }
                
                // Escape HTML
                function escapeHtml(str) {
                    if (!str) return '';
                    const div = document.createElement('div');
                    div.textContent = str;
                    return div.innerHTML;
                }
                
                return `
                    <div class="review-card-modern" style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div class="review-card-header" style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div class="reviewer-info-modern" style="display: flex; align-items: center; gap: 12px;">
                                <div class="reviewer-avatar-modern" style="width: 40px; height: 40px; border-radius: 50%; background: #f3f4f6; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-user" style="color: #6b7280;"></i>
                                </div>
                                <div class="reviewer-details-modern">
                                    <h4 class="reviewer-name" style="margin: 0; font-size: 16px; font-weight: 600; color: #111827;">${escapeHtml(reviewerName)}</h4>
                                    <span class="review-date-modern" style="font-size: 14px; color: #6b7280;">${dateStr}</span>
                                </div>
                            </div>
                            <div class="review-rating-modern">
                                <div class="stars-container" style="font-size: 18px;">
                                    <span class="stars-filled" style="color: #fbbf24;">${filledStars}</span>
                                    <span class="stars-empty" style="color: #d1d5db;">${emptyStars}</span>
                                </div>
                            </div>
                        </div>
                        <div class="review-card-content">
                            <p class="review-text" style="margin: 0; color: #374151; line-height: 1.6;">${escapeHtml(text)}</p>
                        </div>
                    </div>
                `;
            }).join('');
            
            console.log('‚úÖ Recenze zobrazeny');
        }

        function updateRatingsDisplay(userProfile) {
            console.log('üîÑ Updating ratings display:', userProfile);
            
            // Update overall rating
            const overallRating = userProfile?.rating || 0;
            const totalReviews = userProfile?.totalReviews || 0;
            
            // Update rating summary
            const ratingNumber = document.querySelector('.rating-number');
            if (ratingNumber) {
                if (totalReviews > 0) {
                    ratingNumber.textContent = overallRating.toFixed(1);
                } else {
                    ratingNumber.textContent = '-';
                }
            }

            const ratingCount = document.querySelector('.rating-count');
            if (ratingCount) {
                if (totalReviews > 0) {
                    ratingCount.textContent = `Zalo≈æeno na ${totalReviews} hodnocen√≠ch`;
                } else {
                    ratingCount.textContent = 'Zat√≠m ≈æ√°dn√° hodnocen√≠';
                }
            }

            // Update rating breakdown
            updateRatingBreakdown(userProfile, totalReviews);

            // Recenze se naƒçtou a zobraz√≠ v loadAndDisplayAllReviews, ne zde
        }

        function updateRatingBreakdown(userProfile, totalReviews) {
            console.log('üìä Updating rating breakdown:', { userProfile, totalReviews });
            
            const breakdown = userProfile?.ratingBreakdown || {
                5: 0, 4: 0, 3: 0, 2: 0, 1: 0
            };

            // Update 5-star rating
            const fiveStarCount = document.querySelector('.rating-bar-5 .rating-count');
            const fiveStarBar = document.querySelector('.rating-bar-5 .fill');
            if (fiveStarCount) fiveStarCount.textContent = breakdown[5] || 0;
            if (fiveStarBar) {
                const percentage = totalReviews > 0 ? (breakdown[5] / totalReviews) * 100 : 0;
                fiveStarBar.style.width = `${percentage}%`;
            }

            // Update 4-star rating
            const fourStarCount = document.querySelector('.rating-bar-4 .rating-count');
            const fourStarBar = document.querySelector('.rating-bar-4 .fill');
            if (fourStarCount) fourStarCount.textContent = breakdown[4] || 0;
            if (fourStarBar) {
                const percentage = totalReviews > 0 ? (breakdown[4] / totalReviews) * 100 : 0;
                fourStarBar.style.width = `${percentage}%`;
            }

            // Update 3-star rating
            const threeStarCount = document.querySelector('.rating-bar-3 .rating-count');
            const threeStarBar = document.querySelector('.rating-bar-3 .fill');
            if (threeStarCount) threeStarCount.textContent = breakdown[3] || 0;
            if (threeStarBar) {
                const percentage = totalReviews > 0 ? (breakdown[3] / totalReviews) * 100 : 0;
                threeStarBar.style.width = `${percentage}%`;
            }

            // Update 2-star rating
            const twoStarCount = document.querySelector('.rating-bar-2 .rating-count');
            const twoStarBar = document.querySelector('.rating-bar-2 .fill');
            if (twoStarCount) twoStarCount.textContent = breakdown[2] || 0;
            if (twoStarBar) {
                const percentage = totalReviews > 0 ? (breakdown[2] / totalReviews) * 100 : 0;
                twoStarBar.style.width = `${percentage}%`;
            }

            // Update 1-star rating
            const oneStarCount = document.querySelector('.rating-bar-1 .rating-count');
            const oneStarBar = document.querySelector('.rating-bar-1 .fill');
            if (oneStarCount) oneStarCount.textContent = breakdown[1] || 0;
            if (oneStarBar) {
                const percentage = totalReviews > 0 ? (breakdown[1] / totalReviews) * 100 : 0;
                oneStarBar.style.width = `${percentage}%`;
            }
            
            console.log('‚úÖ Rating breakdown updated');
        }

        function updateRecentReviews(userProfile) {
            const reviewsContainer = document.querySelector('.reviews-list');
            if (!reviewsContainer) return;

            const reviews = userProfile?.recentReviews || [];

            if (reviews.length === 0) {
                reviewsContainer.innerHTML = `
                    <div class="no-reviews">
                                <i class="fas fa-star"></i>
                        <h3>Zat√≠m nem√°te ≈æ√°dn√° hodnocen√≠</h3>
                        <p>Jakmile z√≠sk√°te prvn√≠ hodnocen√≠ od z√°kazn√≠k≈Ø, zobraz√≠ se zde.</p>
                            </div>
                `;
                return;
            }

            reviewsContainer.innerHTML = reviews.map(review => createReviewCard(review)).join('');
        }

        function createReviewCard(review) {
            console.log('üîç Creating review card for:', review);
            console.log('üîç Available fields:', Object.keys(review));
            console.log('üîç ReviewerId:', review.reviewerId);
            console.log('üîç ReviewerName:', review.reviewerName);
            
            const stars = Array.from({length: 5}, (_, i) => 
                `<i class="fas fa-star ${i < review.rating ? 'filled' : ''}"></i>`
            ).join('');

            // Get reviewer name from various possible fields
            const reviewerName = review.reviewerName || 
                                review.userName || 
                                review.authorName || 
                                review.fromUserName || 
                                review.name ||
                                'Anonymn√≠';

            // Get review text from various possible fields
            const reviewText = review.comment || 
                              review.text || 
                              review.message || 
                              review.reviewText || 
                              review.description || 
                              '≈Ω√°dn√Ω koment√°≈ô';

            // Get service title from various possible fields
            const serviceTitle = review.serviceTitle || 
                                review.adTitle || 
                                review.title || 
                                review.serviceName || 
                                'Slu≈æba';

            console.log('üîç Final reviewer name:', reviewerName);

            return `
                <div class="review-item">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="reviewer-details">
                                <div class="reviewer-name">${reviewerName}</div>
                                <div class="review-date">${getTimeAgo(review.updatedAt || review.createdAt)}</div>
                            </div>
                        </div>
                        <div class="review-rating">
                            ${stars}
                        </div>
                    </div>
                    <div class="review-content">
                        <h4 class="review-service">${serviceTitle}</h4>
                        <p class="review-text">${reviewText}</p>
                    </div>
                </div>
            `;
        }

        function getTimeAgo(date) {
            if (!date) return 'Nezn√°m√© datum';
            let reviewDate;
            if (date.toDate && typeof date.toDate === 'function') {
                reviewDate = date.toDate();
            } else if (date instanceof Date) {
                reviewDate = date;
            } else {
                reviewDate = new Date(date);
            }
            
            const now = new Date();
            const diffMs = now - reviewDate;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const diffWeeks = Math.floor(diffDays / 7);

            if (diffWeeks > 0) {
                return `P≈ôed ${diffWeeks} t√Ωdny`;
            } else if (diffDays > 0) {
                return `P≈ôed ${diffDays} dny`;
            } else {
                return 'Dnes';
            }
        }

        // Load actual user data
        async function loadUserData() {
            console.log('üíæ Loading user data...');
            try {
                const currentUser = window.firebaseAuth.currentUser;
                if (!currentUser) {
                    console.log('‚ö†Ô∏è U≈æivatel nen√≠ p≈ôihl√°≈°en');
                    return;
                }

                console.log('üë§ Naƒç√≠t√°m data pro u≈æivatele:', currentUser.uid);

                // Load user profile from Firestore
                const { getDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const profileRef = doc(window.firebaseDb, 'users', currentUser.uid, 'profile', 'profile');
                const profileSnap = await getDoc(profileRef);
                
                let userProfile = null;
                if (profileSnap.exists()) {
                    userProfile = profileSnap.data();
                }

                // Load user ads to get statistics
                const { getDocs, collection } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const adsRef = collection(window.firebaseDb, 'users', currentUser.uid, 'inzeraty');
                const adsSnapshot = await getDocs(adsRef);
                
                const userAds = [];
                adsSnapshot.forEach((doc) => {
                    userAds.push({ id: doc.id, ...doc.data() });
                });

                // Update statistics
                console.log('üìä Calling updateStatistics with:', { userAds: userAds.length, userProfile });
                updateStatistics(userAds, userProfile);
                
                // Load all reviews and update rating after loading
                await loadUserReviews(currentUser.uid);
                await displayUserReviews();

            } catch (error) {
                console.error('Chyba p≈ôi naƒç√≠t√°n√≠ dat u≈æivatele:', error);
            }
        }

        // Update statistics with real data
        function updateStatistics(userAds, userProfile) {
            console.log('üìä Updating statistics:', { userAds, userProfile });
            
            // Active ads count
            const activeAds = userAds ? userAds.filter(ad => ad.status === 'active').length : 0;
            const activeAdsElement = document.querySelector('.stat-card:nth-child(1) .stat-number');
            if (activeAdsElement) {
                activeAdsElement.textContent = activeAds > 0 ? activeAds : '-';
                console.log('üìù Updated active ads:', activeAds);
            }

            // Rating will be updated after loading reviews
            const ratingElement = document.querySelector('.stat-card:nth-child(2) .stat-number');
            if (ratingElement) {
                ratingElement.textContent = '-';
            }
            
            console.log('‚úÖ Statistics updated');
        }

        // Load user reviews (stejnƒõ jako v profile-detail.js)
        async function loadUserReviews(userId) {
            try {
                const { getDocs, collection, collectionGroup } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                
                userReviews = [];
                
                // 1. Naƒç√≠st recenze na profilu u≈æivatele (users/{userId}/reviews)
                try {
                    const profileReviewsRef = collection(window.firebaseDb, 'users', userId, 'reviews');
                    const profileReviewsSnap = await getDocs(profileReviewsRef);
                    profileReviewsSnap.forEach(doc => {
                        const reviewData = doc.data();
                        reviewData.id = doc.id;
                        reviewData.type = 'profile';
                        userReviews.push(reviewData);
                    });
                    console.log('‚úÖ Profile reviews loaded:', profileReviewsSnap.size);
                } catch (profileError) {
                    console.warn('‚ö†Ô∏è Error loading profile reviews:', profileError);
                }
                
                // 2. Naƒç√≠st recenze na inzer√°tech u≈æivatele pomoc√≠ collectionGroup
                try {
                const adReviewsGroup = collectionGroup(window.firebaseDb, 'reviews');
                    const adReviewsSnap = await getDocs(adReviewsGroup);
                    adReviewsSnap.forEach(docSnap => {
                        const reviewData = docSnap.data();
                        // Zkontrolovat, zda recenze pat≈ô√≠ k inzer√°tu tohoto u≈æivatele
                    const parent = docSnap.ref.parent; // reviews collection
                    const adDoc = parent?.parent; // adId document
                    const inzeraty = adDoc?.parent; // 'inzeraty' collection
                    const userDoc = inzeraty?.parent; // user uid document
                    
                    if (userDoc && userDoc.id === userId && inzeraty.id === 'inzeraty') {
                            reviewData.id = docSnap.id;
                            reviewData.type = 'ad';
                            reviewData.adId = adDoc.id;
                            userReviews.push(reviewData);
                        }
                    });
                    console.log('‚úÖ Ad reviews loaded from collectionGroup');
                } catch (adReviewsError) {
                    console.warn('‚ö†Ô∏è Error loading ad reviews:', adReviewsError);
                }
                
                // 3. Fallback: zkusit root kolekci reviews (pokud existuje)
                try {
                    const rootReviewsRef = collection(window.firebaseDb, 'reviews');
                    const rootReviewsSnap = await getDocs(rootReviewsRef);
                    rootReviewsSnap.forEach(doc => {
                        const reviewData = doc.data();
                        if (reviewData.reviewedUserId === userId) {
                            // Zkontrolovat, zda u≈æ nen√≠ v seznamu
                            const exists = userReviews.some(r => r.id === doc.id);
                            if (!exists) {
                                reviewData.id = doc.id;
                                reviewData.type = reviewData.type || 'unknown';
                                userReviews.push(reviewData);
                            }
                        }
                    });
                    console.log('‚úÖ Root reviews checked');
                } catch (rootError) {
                    console.warn('‚ö†Ô∏è Error loading root reviews (this is OK if collection doesn\'t exist):', rootError.message);
                }
                
                console.log('‚úÖ Total user reviews loaded:', userReviews.length);

            } catch (error) {
                console.error('‚ùå Error loading user reviews:', error);
                console.error('Error details:', {
                    code: error.code,
                    message: error.message
                });
                userReviews = [];
            }
        }

        // Update rating in statistics from reviews
        function updateRatingFromReviews(reviews) {
            console.log('üîÑ updateRatingFromReviews called with:', reviews?.length || 0, 'reviews');
            
            if (!reviews || reviews.length === 0) {
                console.log('‚ö†Ô∏è No reviews provided to updateRatingFromReviews');
                return;
            }
            
            // Calculate average rating
            const avgRating = reviews.reduce((sum, r) => sum + (r.rating || 0), 0) / reviews.length;
            
            // Calculate rating breakdown
            const breakdown = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 };
            reviews.forEach(review => {
                const rating = review.rating || 0;
                if (rating >= 1 && rating <= 5) {
                    breakdown[rating]++;
                }
            });
            
            console.log('üìä Rating breakdown:', breakdown);
            console.log('üìä Average rating:', avgRating.toFixed(1));
            
            // Update overall rating display
            const ratingNumber = document.querySelector('.rating-number');
            if (ratingNumber) {
                ratingNumber.textContent = avgRating.toFixed(1);
            }

            const ratingCount = document.querySelector('.rating-count');
            if (ratingCount) {
                ratingCount.textContent = `Zalo≈æeno na ${reviews.length} hodnocen√≠ch`;
            }
            
            // Update rating breakdown
            updateRatingBreakdownFromData(breakdown, reviews.length);
            
            // Update statistics card
            const ratingElement = document.querySelector('.stat-card:nth-child(2) .stat-number');
            if (ratingElement) {
                ratingElement.textContent = avgRating.toFixed(1);
                console.log('üìù Updated rating from reviews:', avgRating.toFixed(1), 'reviews:', reviews.length);
            }
            
            // NEP≈òEPISOVAT recenze zde - to se dƒõl√° v displayUserReviews() po naƒçten√≠
            // updateRecentReviewsFromData(reviews); // ODSTRANƒöNO - zp≈Øsobovalo p≈ôepisov√°n√≠
        }

        // Update rating breakdown from calculated data
        function updateRatingBreakdownFromData(breakdown, totalReviews) {
            console.log('üìä Updating rating breakdown from data:', { breakdown, totalReviews });
            
            // Update 5-star rating
            const fiveStarCount = document.querySelector('.rating-bar-5 .rating-count');
            const fiveStarBar = document.querySelector('.rating-bar-5 .fill');
            if (fiveStarCount) fiveStarCount.textContent = breakdown[5] || 0;
            if (fiveStarBar) {
                const percentage = totalReviews > 0 ? (breakdown[5] / totalReviews) * 100 : 0;
                fiveStarBar.style.width = `${percentage}%`;
            }

            // Update 4-star rating
            const fourStarCount = document.querySelector('.rating-bar-4 .rating-count');
            const fourStarBar = document.querySelector('.rating-bar-4 .fill');
            if (fourStarCount) fourStarCount.textContent = breakdown[4] || 0;
            if (fourStarBar) {
                const percentage = totalReviews > 0 ? (breakdown[4] / totalReviews) * 100 : 0;
                fourStarBar.style.width = `${percentage}%`;
            }

            // Update 3-star rating
            const threeStarCount = document.querySelector('.rating-bar-3 .rating-count');
            const threeStarBar = document.querySelector('.rating-bar-3 .fill');
            if (threeStarCount) threeStarCount.textContent = breakdown[3] || 0;
            if (threeStarBar) {
                const percentage = totalReviews > 0 ? (breakdown[3] / totalReviews) * 100 : 0;
                threeStarBar.style.width = `${percentage}%`;
            }

            // Update 2-star rating
            const twoStarCount = document.querySelector('.rating-bar-2 .rating-count');
            const twoStarBar = document.querySelector('.rating-bar-2 .fill');
            if (twoStarCount) twoStarCount.textContent = breakdown[2] || 0;
            if (twoStarBar) {
                const percentage = totalReviews > 0 ? (breakdown[2] / totalReviews) * 100 : 0;
                twoStarBar.style.width = `${percentage}%`;
            }

            // Update 1-star rating
            const oneStarCount = document.querySelector('.rating-bar-1 .rating-count');
            const oneStarBar = document.querySelector('.rating-bar-1 .fill');
            if (oneStarCount) oneStarCount.textContent = breakdown[1] || 0;
            if (oneStarBar) {
                const percentage = totalReviews > 0 ? (breakdown[1] / totalReviews) * 100 : 0;
                oneStarBar.style.width = `${percentage}%`;
            }
            
            console.log('‚úÖ Rating breakdown updated from data');
        }

        // Helper function to get time ago (stejnƒõ jako v profile-detail.js)
        function getTimeAgo(date) {
            if (!date) return 'Nezn√°m√© datum';
            let reviewDate;
            if (date && date.toDate && typeof date.toDate === 'function') {
                reviewDate = date.toDate();
            } else if (date instanceof Date) {
                reviewDate = date;
            } else {
                reviewDate = new Date(date);
            }
            
            const now = new Date();
            const diff = now - reviewDate;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (days === 0) return 'Dnes';
            if (days === 1) return 'Vƒçera';
            if (days < 7) return `P≈ôed ${days} dny`;
            if (days < 30) return `P≈ôed ${Math.floor(days / 7)} t√Ωdny`;
            if (days < 365) return `P≈ôed ${Math.floor(days / 30)} mƒõs√≠ci`;
            return `P≈ôed ${Math.floor(days / 365)} lety`;
        }

        // Create review card (stejnƒõ jako v profile-detail.js)
        function createReviewCard(review) {
            // Zpracovat createdAt (m≈Ø≈æe b√Ωt Timestamp nebo Date)
            let createdAt;
            if (review.createdAt) {
                if (typeof review.createdAt.toDate === 'function') {
                    createdAt = review.createdAt.toDate();
                } else if (review.createdAt instanceof Date) {
                    createdAt = review.createdAt;
                } else {
                    createdAt = new Date(review.createdAt);
                }
            } else if (review.updatedAt) {
                if (typeof review.updatedAt.toDate === 'function') {
                    createdAt = review.updatedAt.toDate();
                } else if (review.updatedAt instanceof Date) {
                    createdAt = review.updatedAt;
                } else {
                    createdAt = new Date(review.updatedAt);
                }
            } else {
                createdAt = new Date();
            }
            
            const timeAgo = getTimeAgo(createdAt);
            
            // Pou≈æ√≠t spr√°vn√° pole: text m√≠sto comment, reviewerName (u≈æ naƒçten√©)
            const reviewText = review.text || review.comment || 'Recenze bez koment√°≈ôe.';
            const reviewerName = review.reviewerName || review.reviewerEmail?.split('@')[0] || 'Anonymn√≠';
            
            // Vytvo≈ôit hvƒõzdiƒçky s lep≈°√≠m designem (stejnƒõ jako v profile-detail.js)
            const filledStars = '‚òÖ'.repeat(review.rating || 0);
            const emptyStars = '‚òÜ'.repeat(5 - (review.rating || 0));
            
            // Escape HTML
            function escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            return `
                <div class="review-card-modern">
                    <div class="review-card-header">
                        <div class="reviewer-info-modern">
                            <div class="reviewer-avatar-modern">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="reviewer-details-modern">
                                <h4 class="reviewer-name">${escapeHtml(reviewerName)}</h4>
                                <span class="review-date-modern">${timeAgo}</span>
                            </div>
                        </div>
                        <div class="review-rating-modern">
                            <div class="stars-container">
                                <span class="stars-filled">${filledStars}</span>
                                <span class="stars-empty">${emptyStars}</span>
                            </div>
                        </div>
                    </div>
                    <div class="review-card-content">
                        <p class="review-text">${escapeHtml(reviewText)}</p>
                    </div>
                </div>
            `;
        }

        // Display user reviews (stejnƒõ jako v profile-detail.js)
        async function displayUserReviews() {
            const reviewsGrid = document.querySelector('.reviews-list');
            if (!reviewsGrid) {
                console.error('‚ùå Reviews container (.reviews-list) not found!');
                return;
            }
            
            console.log('üìù displayUserReviews called, userReviews.length:', userReviews.length);
            
            if (userReviews.length === 0) {
                reviewsGrid.innerHTML = `
                    <div style="
                        text-align: center;
                        padding: 60px 20px;
                        background: white;
                        border-radius: 16px;
                        border: 2px dashed #e5e7eb;
                    ">
                        <i class="fas fa-star" style="font-size: 48px; color: #d1d5db; margin-bottom: 16px;"></i>
                        <p style="
                            font-size: 16px;
                            color: #6b7280;
                            margin: 0;
                            font-weight: 500;
                        ">U≈æivatel zat√≠m nem√° ≈æ√°dn√© recenze.</p>
                    </div>
                `;
                return;
            }
            
            // Naƒç√≠st jm√©na recenzent≈Ø
            const reviewsWithNames = await Promise.all(
                userReviews.map(async (review) => {
                    let reviewerName = review.reviewerName || review.reviewerEmail || 'Anonymn√≠';
                    
                    // Pokud m√°me reviewerId, zkus naƒç√≠st jm√©no z profilu
                    if (review.reviewerId && !review.reviewerName) {
                        try {
                            const { getDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                            const reviewerProfileRef = doc(window.firebaseDb, 'users', review.reviewerId, 'profile', 'profile');
                            const reviewerProfileSnap = await getDoc(reviewerProfileRef);
                            
                            if (reviewerProfileSnap.exists()) {
                                const reviewerData = reviewerProfileSnap.data();
                                reviewerName = reviewerData.name || 
                                               (reviewerData.firstName && reviewerData.lastName 
                                                ? `${reviewerData.firstName} ${reviewerData.lastName}`.trim()
                                                : reviewerData.email?.split('@')[0] || reviewerName);
                            }
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Nepoda≈ôilo se naƒç√≠st jm√©no recenzenta:', error);
                        }
                    }
                    
                    return {
                        ...review,
                        reviewerName: reviewerName
                    };
                })
            );
            
            reviewsGrid.innerHTML = reviewsWithNames.map(review => createReviewCard(review)).join('');
            console.log('‚úÖ Reviews displayed:', reviewsWithNames.length);
        }
        
        // Render all reviews function (stejnƒõ jako v profile.html)
        function renderAllReviews(reviews, container) {
            console.log('üé® renderAllReviews called with', reviews?.length || 0, 'reviews');
            if (!reviews || reviews.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 16px; border: 2px dashed #e5e7eb;">
                        <i class="fas fa-star" style="font-size: 48px; color: #d1d5db; margin-bottom: 16px;"></i>
                        <p style="font-size: 16px; color: #6b7280; margin: 0; font-weight: 500;">U≈æivatel zat√≠m nem√° ≈æ√°dn√© recenze.</p>
                    </div>
                `;
                return;
            }

            // Helper function to get time ago
            function getTimeAgoHelper(date) {
                if (!date) return 'Nezn√°m√© datum';
                let reviewDate;
                if (date.toDate && typeof date.toDate === 'function') {
                    reviewDate = date.toDate();
                } else if (date instanceof Date) {
                    reviewDate = date;
                } else {
                    reviewDate = new Date(date);
                }
                
                const now = new Date();
                const diffMs = now - reviewDate;
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) return 'Dnes';
                if (diffDays === 1) return 'Vƒçera';
                if (diffDays < 7) return `P≈ôed ${diffDays} dny`;
                if (diffDays < 30) return `P≈ôed ${Math.floor(diffDays / 7)} t√Ωdny`;
                if (diffDays < 365) return `P≈ôed ${Math.floor(diffDays / 30)} mƒõs√≠ci`;
                return `P≈ôed ${Math.floor(diffDays / 365)} lety`;
            }
            
            // Helper function to escape HTML
            function escapeHtml(str) {
                if (!str) return '';
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            }
            
            // Helper function to create review card
            function createReviewCardHelper(review) {
                const rating = review.rating || 0;
                const filledStars = '‚òÖ'.repeat(rating);
                const emptyStars = '‚òÜ'.repeat(5 - rating);
                const text = review.text || review.comment || '≈Ω√°dn√Ω koment√°≈ô';
                const reviewerName = review.reviewerName || review.reviewerEmail?.split('@')[0] || 'Anonymn√≠';
                const timeAgo = getTimeAgoHelper(review.createdAt || review.updatedAt);
                
                return `
                    <div class="review-card-modern" style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div class="review-card-header" style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div class="reviewer-info-modern" style="display: flex; align-items: center; gap: 12px;">
                                <div class="reviewer-avatar-modern" style="width: 40px; height: 40px; border-radius: 50%; background: #f3f4f6; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-user" style="color: #6b7280;"></i>
                                </div>
                                <div class="reviewer-details-modern">
                                    <h4 class="reviewer-name" style="margin: 0; font-size: 16px; font-weight: 600; color: #111827;">${escapeHtml(reviewerName)}</h4>
                                    <span class="review-date-modern" style="font-size: 14px; color: #6b7280;">${timeAgo}</span>
                                </div>
                            </div>
                            <div class="review-rating-modern">
                                <div class="stars-container" style="font-size: 18px;">
                                    <span class="stars-filled" style="color: #fbbf24;">${filledStars}</span>
                                    <span class="stars-empty" style="color: #d1d5db;">${emptyStars}</span>
                                </div>
                            </div>
                        </div>
                        <div class="review-card-content">
                            <p class="review-text" style="margin: 0; color: #374151; line-height: 1.6;">${escapeHtml(text)}</p>
                        </div>
                    </div>
                `;
            }
            
            // Render reviews
            container.innerHTML = reviews.map(review => createReviewCardHelper(review)).join('');
            console.log('‚úÖ Reviews rendered:', reviews.length);
        }

        // Update recent reviews from loaded data
        function updateRecentReviewsFromData(reviews) {
            console.log('üìù updateRecentReviewsFromData called with:', reviews?.length || 0, 'reviews');
            console.log('üìù userReviews.length:', userReviews?.length || 0);
            
            // V≈ΩDY pou≈æ√≠t userReviews pokud jsou naƒçten√© (maj√≠ p≈ôednost)
            if (userReviews && userReviews.length > 0) {
                console.log('üìù Using userReviews (preferred):', userReviews.length);
                displayUserReviews().catch(err => {
                    console.error('‚ùå Error in displayUserReviews:', err);
                });
                return;
            }
            
            // Fallback: pou≈æ√≠t p≈ôedan√© recenze
            if (!reviews || reviews.length === 0) {
                console.log('üìù No reviews found, showing empty state');
                const reviewsContainer = document.querySelector('.reviews-list');
                if (reviewsContainer) {
                    reviewsContainer.innerHTML = `
                        <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 16px; border: 2px dashed #e5e7eb;">
                            <i class="fas fa-star" style="font-size: 48px; color: #d1d5db; margin-bottom: 16px;"></i>
                            <p style="font-size: 16px; color: #6b7280; margin: 0; font-weight: 500;">U≈æivatel zat√≠m nem√° ≈æ√°dn√© recenze.</p>
                        </div>
                    `;
                }
                return;
            }

            // Sort reviews by date (newest first)
            const sortedReviews = [...reviews].sort((a, b) => {
                const dateA = new Date(a.updatedAt?.toDate?.() || a.updatedAt || a.createdAt?.toDate?.() || a.createdAt || 0);
                const dateB = new Date(b.updatedAt?.toDate?.() || b.updatedAt || b.createdAt?.toDate?.() || b.createdAt || 0);
                return dateB - dateA;
            });

            console.log('üìù Rendering', sortedReviews.length, 'reviews using renderAllReviews');
            const reviewsContainer = document.querySelector('.reviews-list');
            if (!reviewsContainer) {
                console.error('‚ùå Reviews container (.reviews-list) not found!');
                return;
            }
            
            renderAllReviews(sortedReviews, reviewsContainer);
            console.log('‚úÖ Reviews rendered to container');
        }
    </script>
</body>
</html>
